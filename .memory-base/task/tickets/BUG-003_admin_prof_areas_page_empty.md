# BUG-003: Страница админки для профобластей — пустой список и сломанный UI

Дата: 2025-11-11
Приоритет: High
Тип: Bug
Статус: Open
Затронутая область: Frontend (Admin → Профобласти/весовые таблицы), возможно Backend API для списка профобластей

## Контекст
На странице админки для управления весовыми таблицами/профессиональными областями (маршрут `/admin/weights`) интерфейс взаимодействия рендерится некорректно: отсутствуют ожидаемые элементы управления и контент, а при загрузке отображается пустой список без лоадера/плейсхолдера и без ошибок.

Скриншоты от пользователя указывают на:
- верхняя панель видна, но центральная область пустая (нет карточек/таблицы/кнопок кроме «Новая область» или даже её);
- после прогрузки остаётся пустой список, хотя ожидается список профобластей или понятный пустой стейт.

## Окружение
- Локально: FastAPI на `http://localhost:9187` (прод-сборка фронтенда через StaticFiles)
- Пользователь под ролью ADMIN (`admin@test.com`)
- Маршрут: `/admin/weights`

## Как воспроизвести
1. Авторизоваться под админом.
2. Перейти в раздел «Админ» → «Весовые таблицы» (URL: `/admin/weights`).
3. Наблюдать контент центральной части страницы.

## Ожидаемое поведение
- Отображается корректный UI с заголовком, поиском, списком профобластей и пустым стейтом (если данных нет) с явным текстом и CTA «Новая область».
- При отсутствии профобластей отображается пустой стейт с подсказкой и кнопкой для создания.
- При наличии профобластей — виден список/таблица с пагинацией/поиском.
- В случае ошибки загрузки — отображается понятное сообщение об ошибке/ретрай.

## Фактическое поведение
- Центральная область пустая; не отображаются элементы списка/плейсхолдеры.
- Видимость кнопки «Новая область» нестабильна (на одном скрине есть, на другом — пусто).

## Возможные гипотезы причин
- Неверная инициализация состояния Pinia/компонента при «прод» режиме через StaticFiles.
- Ошибка в обработке ответа API (неправильный `baseURL`/дублирование `/api`, ожидание другого поля в JSON).
- Непойманыe исключения в `setup()`/`onMounted()` (рендер падает до вывода ошибок).
- Отсутствует лоадер/скелетон и условные рендеры скрывают контент при `null/undefined`.
- Несогласованность роутера и компонента: ленивый импорт не возвращает компонент/неверный путь.

## Диагностика (что проверить)
- Консоль браузера на наличие ошибок (TypeError/undefined, CORS, 404 по статике или API).
- Сеть: запрос на загрузку списка профобластей (ожидаемо `GET /api/prof-activities` или аналог) — статус/ответ.
- Правильность `axios` базы (`/api`) и отсутствие двойного префикса.
- Условия рендера в компоненте страницы: ветки `v-if`/`v-else-if` для состояний `loading/empty/error/data`.
- Наличие и корректность пустого стейта.

## Следующие шаги (план фикса)
- [ ] Добавить явные состояния `loading`, `error`, `empty` и соответствующие блоки рендера.
- [ ] Починить вызов API (конечная точка, маппинг ответа, обработка ошибок).
- [ ] Обеспечить отображение кнопки «Новая область» всегда (кроме `loading`), с корректным модальным диалогом создания.
- [ ] Покрыть страницу компонентным тестом (Vitest) на три сценария: error/empty/with data.
- [ ] Включить логирование ошибок в консоль/телеметрию (в dev).

## Критерии приёмки
- При отсутствии данных отображается пустой стейт с CTA «Новая область».
- При ошибке загрузки показывается блок с сообщением и кнопкой «Повторить».
- При наличии данных — список/таблица отображается корректно, поиск работает.
- Нет ошибок в консоли; API запрос(ы) успешны и корректно парсятся.
- Юнит-тесты фронтенда для страницы проходят.

## Ссылки/материалы
- Скриншоты пользователя (см. описание задачи).
- Смежные баги: `BUG-001_metrics_input_fields_not_rendering.md`, `BUG-002_metrics_dialog_not_opening_in_automated_tests.md` (возможны схожие причины условного рендера).


