Код: S3-06 — Извлечение метрик из отчета Prasol через Gemini

Цель
- Извлечь метрики из нового отчета `Prasol_A.M._Biznes-Profil_Otchyot_upravlencheskogo_potentsiala_1720193.docx` через Gemini Vision и добавить их в базовые метрики системы.

Описание
- Обработать новый DOCX отчет через пайплайн извлечения метрик (Gemini Vision), определить новые метрики, которых нет в текущем наборе MetricDef, и добавить их в систему. Обновить маппинг в `config/app/metric-mapping.yaml` для поддержки новых метрик. Обеспечить отображение новых метрик в интерфейсе участников и в профиле весов.

Шаги

1. **Загрузка и обработка отчета**
   - Загрузить отчет `Prasol_A.M._Biznes-Profil_Otchyot_upravlencheskogo_potentsiala_1720193.docx` через API
   - Запустить задачу извлечения изображений (`extract_images_from_report`)
   - Дождаться завершения извлечения изображений (статус EXTRACTED)

2. **Извлечение метрик через Gemini Vision**
   - Запустить задачу извлечения метрик (`extract_metrics_from_report_images`)
   - Использовать существующий `MetricExtractionService` с Gemini Vision
   - Получить список извлеченных метрик с их ярлыками и значениями

3. **Анализ новых метрик**
   - Сравнить извлеченные ярлыки с существующими маппингами в `config/app/metric-mapping.yaml`
   - Определить метрики, которых нет в текущем наборе MetricDef
   - Для каждой новой метрики:
     - Определить уникальный `code` (snake_case)
     - Определить русское название (`name_ru`)
     - Установить диапазон значений [1..10] по умолчанию

4. **Добавление новых метрик в систему**
   - Обновить `config/app/metric-mapping.yaml`: добавить маппинги для новых метрик
   - Обновить `seed_metric_defs.py`: добавить русские названия для новых метрик
   - Запустить сидирование: создать записи MetricDef в БД
   - Убедиться, что новые метрики имеют `active=true`

5. **Повторное извлечение метрик**
   - После добавления новых MetricDef, повторно запустить извлечение метрик для отчета Prasol
   - Проверить, что все метрики успешно сохранены в `extracted_metric`
   - Валидировать значения: диапазон [1..10], формат чисел (RU locale)

6. **Интеграция в UI**
   - Проверить отображение новых метрик в комнате участников (`ParticipantDetailView.vue`)
   - Проверить доступность новых метрик в профиле весов (WeightTable)
   - Убедиться, что русские названия отображаются корректно

Тестирование (обязательно)

- **Unit тесты**:
  - Тест извлечения метрик из отчета Prasol
  - Тест маппинга новых ярлыков в metric_code
  - Тест создания новых MetricDef записей

- **Интеграционные тесты**:
  - Полный цикл: загрузка → извлечение изображений → извлечение метрик → сохранение
  - Проверка валидности значений (диапазон, формат)
  - Проверка отсутствия дубликатов метрик

- **E2E тесты**:
  - Загрузка отчета Prasol через UI
  - Проверка отображения метрик в карточке участника
  - Проверка доступности метрик при создании/редактировании таблицы весов

AC (Критерии приемки)

- ✅ Все метрики из отчета Prasol успешно извлечены через Gemini Vision
- ✅ Новые метрики добавлены в MetricDef с корректными кодами и русскими названиями
- ✅ Маппинг обновлен в `config/app/metric-mapping.yaml`
- ✅ Новые метрики отображаются в интерфейсе участников
- ✅ Новые метрики доступны для использования в таблицах весов
- ✅ Все значения метрик валидны (диапазон [1..10], формат RU)
- ✅ Нет дубликатов метрик в системе
- ✅ Тесты проходят успешно

Зависимости

- ✅ S3-01 (извлечение изображений из DOCX)
- ✅ S3-02 (stub endpoints для извлечения)
- ✅ AI-01 (Gemini клиент)
- ✅ AI-02 (keys pool и rate limiting)
- ✅ S2-01 (MetricDef и ExtractedMetric модели)
- ✅ S2-09 (русские названия метрик)

Файлы для изменения

**Backend**:
- `config/app/metric-mapping.yaml` — добавить маппинги новых метрик
- `api-gateway/seed_metric_defs.py` — добавить русские названия
- `api-gateway/app/services/metric_extraction.py` — при необходимости обновить логику
- `api-gateway/tests/test_metric_extraction.py` — добавить тесты для нового отчета

**Frontend** (если потребуется):
- `frontend/src/views/ParticipantDetailView.vue` — проверить отображение новых метрик
- `frontend/src/components/MetricsEditor.vue` — проверить поддержку новых метрик

Примечания

- Отчет `Prasol_A.M._Biznes-Profil_Otchyot_upravlencheskogo_potentsiala_1720193.docx` находится в `.memory-base/Product Overview/User story/`
- При извлечении метрик использовать строгий JSON schema для Gemini Vision (см. `extraction-pipeline.md`)
- Валидировать только числовые значения в диапазоне [1..10], игнорировать символические оценки (++, +, -, --)
- При неоднозначностях помечать метрики для ручной валидации через UI
- Логировать все этапы извлечения для отладки



