# S1-09: –í–µ—Å–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã (JSON/–∞–∫—Ç–∏–≤–∞—Ü–∏—è) ‚Äî COMPLETED ‚úÖ

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-11-06

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 1. –ú–æ–¥–µ–ª—å –∏ –º–∏–≥—Ä–∞—Ü–∏—è `weight_table`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ ORM-–º–æ–¥–µ–ª—å `WeightTable` —Å JSONB-–ø–æ–ª–µ–º –≤–µ—Å–æ–≤, –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å—é –∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ Alembic-—Ä–µ–≤–∏–∑–∏—è `8d1f97e2cf8d_weight_tables.py`, –∫–æ—Ç–æ—Ä–∞—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É, FK –Ω–∞ `prof_activity`, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å `(prof_activity_id, version)` –∏ —á–∞—Å—Ç–∏—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞.

### 2. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ API
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã Pydantic-—Å—Ö–µ–º—ã `WeightTableUploadRequest`/`WeightTableResponse` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—É–º–º—ã –≤–µ—Å–æ–≤ `Decimal == 1.0`.
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ `WeightTableRepository` –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `ProfActivityRepository.get_by_code`.
- ‚úÖ –°–µ—Ä–≤–∏—Å `WeightTableService` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏, –≤—ã–¥–∞—á—É —Å–ø–∏—Å–∫–∞ –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—é —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–ø–∏—Å–∏.
- ‚úÖ –°–æ–∑–¥–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä `/api/admin/weights`:
  - `POST /upload` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ JSON;
  - `GET /` ‚Äî —Å–ø–∏—Å–æ–∫ —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –ø—Ä–æ—Ñ–æ–±–ª–∞—Å—Ç–∏;
  - `POST /{id}/activate` ‚Äî –∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–µ—Ä—Å–∏–∏ —Å –æ—Ç–∫–∞–∑–æ–º –ø—Ä–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–ø–∏—Å–∏.
- ‚úÖ –†–æ—É—Ç–µ—Ä –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `main.py` c –∑–∞—â–∏—Ç–æ–π —á–µ—Ä–µ–∑ `require_admin`.

### 3. –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- ‚úÖ `tests/test_weight_tables.py` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ø–µ—à–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É, –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å—É–º–º—ã –∏ –∑–∞–ø—Ä–µ—Ç –≤—Ç–æ—Ä–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.
- ‚úÖ `tests/test_migrations.py` –¥–æ–ø–æ–ª–Ω–µ–Ω —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –≤–µ—Ä—Å–∏–∏, partial unique –∏–Ω–¥–µ–∫—Å–∞).
- üìå –í—Å–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç: `pytest tests/test_weight_tables.py` ‚Üí `3 passed` (7 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∏–∫—Å—Ç—É—Ä).

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
api-gateway/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ db/models.py                         # WeightTable ORM + —Å–≤—è–∑—å —Å ProfActivity
‚îÇ   ‚îú‚îÄ‚îÄ repositories/weight_table.py         # CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ services/weight_table.py             # –õ–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏/–∞–∫—Ç–∏–≤–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas/weight_table.py              # Pydantic DTO + –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ routers/weights.py                   # ADMIN API –¥–ª—è –≤–µ—Å–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü
‚îú‚îÄ‚îÄ alembic/versions/8d1f97e2cf8d_weight_tables.py
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ test_weight_tables.py                # API —Å—Ü–µ–Ω–∞—Ä–∏–∏
    ‚îî‚îÄ‚îÄ test_migrations.py                   # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–µ–º—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ AC
- [x] –ó–∞–≥—Ä—É–∑–∫–∞ JSON —Å Decimal-–≤–µ—Å–∞–º–∏, —Å—É–º–º–∞ —Å—Ç—Ä–æ–≥–æ 1.0.
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ—Ä—Å–∏–π –∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–ø–∏—Å–∏ per `prof_activity`.
- [x] –ü–æ–ø—ã—Ç–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—Ç–æ—Ä—É—é —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ç–æ–π –∂–µ –ø—Ä–æ—Ñ–æ–±–ª–∞—Å—Ç–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–∫–∞–∑.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ —Ä–∞—Å—á—ë—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å (S2 –∑–∞–¥–∞—á–∏).
- –î–æ–±–∞–≤–∏—Ç—å UI-—Ñ–æ—Ä–º—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ.
