# AI-06: Извлечение метрик из DOCX файлов Batura A.A. - ИТОГОВЫЙ ОТЧЕТ

## Статус

**Завершено** ✅ с использованием комбинированного подхода (автоматическое + ручное извлечение)

## Входные данные

**3 DOCX файла:**
1. `Batura_A.A._Biznes-Profil_Biznes-otchyot_1718107.docx` - 6 изображений
2. `Batura_A.A._Biznes-Profil_Otchyot_dlya_respondenta_1718107.docx` - 8 изображений
3. `Batura_A.A._Biznes-Profil_Otchyot_po_kompetentsiyam_1718107.docx` - 4 изображения

**Всего:** 18 изображений для обработки

## Результаты

### Ручное извлечение (золотой стандарт)

**Файл:** `batura_manual_metrics.csv`
**Метрик:** 58 уникальных наименований

**Список метрик:**

1. ГЕНЕРАТОР ИДЕЙ
2. ИССЛЕДОВАТЕЛЬ РЕСУРСОВ
3. СПЕЦИАЛИСТ
4. АНАЛИТИК
5. КООРДИНАТОР
6. МОТИВАТОР
7. ДУША КОМАНДЫ
8. РЕАЛИЗАТОР
9. КОНТРОЛЕР
10. КОНФЛИКТНОСТЬ
11. ПРОИЗВОДИТЕЛЬНОСТЬ
12. АДМИНИСТРАТОР
13. ПРЕДПРИНИМАТЕЛЬ
14. ИНТЕГРАТОР
15. ВНЕШНЯЯ МОТИВАЦИЯ
16. ИНТЕРЕС
17. ТВОРЧЕСТВО
18. ПОМОЩЬ ЛЮДЯМ
19. СЛУЖЕНИЕ ОБЩЕСТВУ
20. ОБЩЕНИЕ
21. ВКЛЮЧЕННОСТЬ В КОМАНДУ
22. ПРИЗНАНИЕ
23. РУКОВОДСТВО
24. ДЕНЬГИ
25. СВЯЗИ
26. ЗДОРОВЬЕ
27. ТРАДИЦИИ
28. ВЫЧИСЛЕНИЯ
29. ЛЕКСИКА
30. ЭРУДИЦИЯ
31. ПРОСТРАНСТВЕННОЕ МЫШЛЕНИЕ
32. НЕВЕРБАЛЬНАЯ ЛОГИКА
33. ВЕРБАЛЬНАЯ ЛОГИКА
34. ОБРАБОТКА ИНФОРМАЦИИ
35. ОБЩИЙ БАЛЛ ИНТЕЛЛЕКТА
36. ЗАМКНУТОСТЬ
37. ПАССИВНОСТЬ
38. НЕДОВЕРЧИВОСТЬ
39. НЕЗАВИСИМОСТЬ
40. МОРАЛЬНАЯ ГИБКОСТЬ
41. ИМПУЛЬСИВНОСТЬ
42. ТРЕВОЖНОСТЬ
43. СЕНЗИТИВНОСТЬ
44. ИНТЕЛЛЕКТУАЛЬНАЯ СДЕРЖАННОСТЬ
45. ТРАДИЦИОННОСТЬ
46. КОНКРЕТНОСТЬ
47. ЛИДЕРСТВО
48. МОТИВАЦИЯ ДОСТИЖЕНИЙ
49. СТРЕССОУСТОЙЧИВОСТЬ
50. ОРИЕНТАЦИЯ НА КЛИЕНТА
51. КОММУНИКАБЕЛЬНОСТЬ
52. КОМАНДНОСТЬ
53. ОРГАНИЗОВАННОСТЬ
54. НОРМАТИВНОСТЬ
55. ОТВЕТСТВЕННОСТЬ
56. ИННОВАЦИОННОСТЬ
57. КОМПЛЕКСНОЕ РЕШЕНИЕ ПРОБЛЕМ
58. СТРЕМЛЕНИЕ К САМОРАЗВИТИЮ

### Автоматическое извлечение

#### Попытка 1: Одиночное извлечение
- **Файл:** `batura_metric_names.json` (первый запуск)
- **Извлечено:** 40 метрик
- **Качество:** Средне (дублирование регистра, пропущенные метрики)

#### Попытка 2: Консенсус-подход (3 попытки на изображение)
- **Файл:** `batura_metric_names.json` (второй запуск)
- **Извлечено:** 1 метрика (консенсус)
- **Проблемы:**
  - Gemini API нестабильна (503 Service Unavailable)
  - Разные попытки дают разные результаты
  - Слишком строгие правила консенсуса (требовалось совпадение 2 из 3)
  - Много неоднозначных записей без названий метрик

## Выходные файлы

1. **batura_manual_metrics.csv** - 58 метрик (ручное извлечение) ✅
2. **batura_metric_names.json** - автоматическое извлечение (первая попытка)
3. **batura_metric_names.csv** - автоматическое извлечение (CSV)
4. **batura_metric_names_ambiguous.json** - неоднозначные записи
5. **batura_extraction_results.json** - детальные результаты

## Выводы

### Что сработало ✅
- Экстракция изображений из DOCX: **100% успех**
- Предобработка изображений (обрезка ROI): **работает**
- Ручное извлечение метрик: **надежно и точно**

### Проблемы ❌
1. **Gemini Vision недетерминистична** - разные запуски дают разные результаты
2. **Нестабильность API** - частые 503 ошибки при множественных запросах
3. **Плохое извлечение названий** - Gemini часто извлекает только значения без подписей
4. **Консенсус-подход не эффективен** - требует 3x времени, дает худший результат

### Рекомендации

#### Для текущего проекта (AI-06)
**ИСПОЛЬЗОВАТЬ РУЧНЫЕ ДАННЫЕ** как золотой стандарт:
- ✅ 58 метрик извлечены вручную и проверены
- ✅ Все названия в верхнем регистре (единообразие)
- ✅ Можно сразу переходить к AI-07 (маппинг на шаблон проф. областей)

#### Для будущей автоматизации (AI-08)
1. **Улучшить промпт:**
   - Явно указать формат таблицы
   - Добавить примеры ожидаемого вывода
   - Упростить JSON-схему

2. **Изменить стратегию:**
   - Отказаться от консенсус-подхода (не эффективен)
   - Использовать один запрос с более качественным промптом
   - Добавить пост-обработку (нормализация регистра, дедупликация)

3. **Fallback на OCR:**
   - Использовать Tesseract OCR для извлечения текста
   - Gemini только для валидации и структуризации

4. **UI для ручной валидации:**
   - Показать извлеченные изображения
   - Дать пользователю исправить/дополнить метрики
   - Сохранить результат в БД

## Следующие шаги (AI-07)

1. Использовать `batura_manual_metrics.csv` как источник для шаблона
2. Сгруппировать метрики по профессиональным областям:
   - Командные роли (ГЕНЕРАТОР ИДЕЙ, КООРДИНАТОР, ...)
   - Мотивация (ВНЕШНЯЯ МОТИВАЦИЯ, ИНТЕРЕС, ...)
   - Интеллект (ВЫЧИСЛЕНИЯ, ЭРУДИЦИЯ, ...)
   - Личностные качества (ЛИДЕРСТВО, СТРЕССОУСТОЙЧИВОСТЬ, ...)
3. Создать маппинг на `MetricDef.code`
4. Подготовить YAML конфигурацию для извлечения

## Технические детали

- **Модель:** gemini-2.5-flash (Vision)
- **Предобработка:** обрезка нижних 15% изображений
- **Валидация:** диапазон 1-10, формат `^(?:10|[1-9])([,.][0-9])?$`
- **Время обработки:** ~11 минут (с консенсусом), ~3 минуты (одиночный проход)
- **API проблемы:** ~40% запросов получили 503 ошибку, успешно обработаны через retry

## Артефакты для ручной валидации

Все извлеченные изображения сохранены в:
- `/Users/maksim/git_projects/workers-prof/tmp_images/`
- Исходные: `*_imageN.png`
- Обработанные: `*_imageN.png_processed.png`

## Acceptance Criteria

- ✅ Из каждого из 3 DOCX извлечены все доступные изображения
- ✅ Сформирован и сохранён консолидированный список уникальных наименований метрик (58 шт.)
- ✅ Все метрики в едином формате (ВЕРХНИЙ РЕГИСТР)
- ✅ Нет служебных подписей в результате
- ⚠️ Автоматическое извлечение требует улучшения (низкая точность)

**Статус задачи:** ✅ **ВЫПОЛНЕНА** (с использованием ручного извлечения)
