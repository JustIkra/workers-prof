Gemini: уникальный промпт для рекомендаций

Цель: получить структурированные рекомендации (strengths, dev_areas, recommendations) на основе распознанных метрик и активной весовой таблицы. Выход — строгий JSON по схеме.

Инпут (передаём в модель)
{
  "context": {
    "language": "ru",
    "prof_activity": {"code": "SALES", "name": "Продажи"},
    "weight_table": {"version": 3}
  },
  "metrics": [
    {"code": "COMMUNICATION_CLARITY", "name": "Ясность речи", "unit": "балл", "value": 4.6, "weight": 0.15},
    {"code": "PLANNING_ACCURACY", "name": "Точность планирования", "unit": "%", "value": 62, "weight": 0.10}
  ],
  "score_pct": 78.4,
  "constraints": {
    "strengths_max": 5, "dev_areas_max": 5, "recommendations_max": 5
  }
}

Системные инструкции (в начало промпта)
- Ты эксперт по оценке компетенций и обучению взрослых.
- Используй только переданные метрики, веса и итоговый процент.
- Не додумывай чисел; если данных не хватает — предложи нейтральные формулировки.
- Пиши по-русски, кратко и конкретно; избегай общих фраз.
- Строго верни ТОЛЬКО JSON по схеме ниже; не добавляй текст вне JSON.

Схема ответа (строгий JSON)
{
  "strengths": [
    {"title": "string", "metric_codes": ["string"], "reason": "string"}
  ],
  "dev_areas": [
    {"title": "string", "metric_codes": ["string"], "actions": ["string"]}
  ],
  "recommendations": [
    {"title": "string", "link_url": "string", "priority": 1}
  ]
}

Пример промпта (сборка)
SYSTEM:
  <системные инструкции>
USER:
  Ниже данные по метрикам и весам для профдеятельности {{prof_activity.name}} (версия весов {{weight_table.version}}). Сформируй рекомендации.
  Инпут:
  {{json_input}}
  Верни только JSON по схеме.

Пост-обработка
- Валидация JSON: парсинг/схема, повторный запрос при невалидности (self-heal prompt)
- Ограничение длины: сокращай названия до 80 символов; список действий ≤ 5

Замечания
- Для сложных кейсов можно добавлять краткое резюме отчёта как контекст (summary), но не передавать PII.

