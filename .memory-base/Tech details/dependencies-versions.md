# Версии зависимостей и политика обновлений

**Дата последнего обновления:** Ноябрь 2025

## Политика версионирования

Используются **последние стабильные версии** библиотек, совместимые друг с другом. При обновлении зависимостей необходимо проверять:

1. Совместимость между основными библиотеками (FastAPI + Pydantic + SQLAlchemy)
2. Актуальность security-related пакетов (PyJWT, passlib, cryptography)
3. Соответствие минимальным требованиям Python (3.11+)

## Core Framework

### FastAPI 0.115.7
- **Обоснование:** Полная поддержка Pydantic v2, активная разработка
- **Совместимость:** Python 3.9+, Pydantic 2.10+
- **Важно:** FastAPI переехала с `python-jose` на `PyJWT` в 2025
- **Обновление:** Проверять совместимость с Pydantic при мажорных обновлениях

### Pydantic 2.10.6
- **Обоснование:** Стабильная v2 версия с улучшенной производительностью
- **Совместимость:** Python 3.9+, FastAPI 0.100+
- **Важно:** v1 deprecated с Python 3.14
- **Обновление:** Следить за breaking changes в минорных версиях

### Pydantic Settings 2.11.0
- **Обоснование:** Последняя версия, отдельный пакет с Pydantic 2.x
- **Совместимость:** Pydantic 2.x, Python 3.9+
- **Важно:** Отдельная установка `pydantic-settings` обязательна
- **Обновление:** Синхронизировать с Pydantic core

### Uvicorn 0.34.0
- **Обоснование:** Стабильный ASGI сервер
- **Extras:** `[standard]` включает uvloop, httptools для производительности
- **Совместимость:** Python 3.8+

## Database

### SQLAlchemy 2.0.44
- **Обоснование:** Последняя стабильная 2.0, полная поддержка async/await
- **Extras:** `[asyncio]` для async engine
- **Совместимость:** Python 3.7+, asyncpg 0.29+
- **Важно:** 2.0 несовместима с 1.4, требует миграции
- **Обновление:** Минорные версии безопасны

### asyncpg 0.30.0
- **Обоснование:** Fastest PostgreSQL driver для Python
- **Совместимость:** PostgreSQL 9.5+, Python 3.8+
- **Обновление:** Стабильная библиотека, обновления безопасны

### Alembic 1.14.0
- **Обоснование:** Официальный инструмент миграций для SQLAlchemy
- **Совместимость:** SQLAlchemy 2.0+
- **Обновление:** Следовать релизам SQLAlchemy

## Authentication & Security

### PyJWT 2.10.1
- **Обоснование:** **Замена python-jose** (рекомендация FastAPI 2025)
- **Extras:** `[crypto]` для RSA/ECDSA алгоритмов
- **Совместимость:** Python 3.9+
- **Важно:**
  - `python-jose` заброшена (последний релиз 2021)
  - `python-jose` несовместима с Python 3.10+
  - PyJWT активно поддерживается и безопаснее
- **Миграция:** API отличается от python-jose, требуется адаптация кода
- **Обновление:** Security-critical, обновлять оперативно

### passlib 1.7.4
- **Обоснование:** Надежное хеширование паролей
- **Extras:** `[bcrypt]` для bcrypt algorithm
- **Совместимость:** Python 3.6+
- **Важно:** Долгая разработка новой версии (2.0)
- **Обновление:** Стабильная, редкие обновления

## Task Queue

### Celery 5.5.0
- **Обоснование:** Последняя стабильная с поддержкой Pydantic models
- **Совместимость:** Python 3.8-3.13, PyPy 3.10+
- **Важно:** Официальная поддержка Python 3.13
- **Обновление:** Минорные версии безопасны

### Redis 5.2.1
- **Обоснование:** **Максимальная совместимая с Celery/Kombu**
- **Важно:**
  - Kombu требует `redis>=4.5.2, !=4.5.5, !=5.0.2, <=5.2.1`
  - Redis 5.3.0+ **несовместима** с текущим Kombu
  - Фиксированная версия до обновления Kombu
- **Обновление:** **НЕ обновлять выше 5.2.1** до совместимости Kombu

## HTTP Client

### httpx 0.28.1
- **Обоснование:** Современный async HTTP клиент
- **Совместимость:** Python 3.9+
- **Обновление:** Стабильная, обновления безопасны

## Document Processing

### python-docx 1.1.2
- **Обоснование:** Стабильная библиотека для работы с .docx
- **Совместимость:** Python 3.7+
- **Обновление:** Редкие, стабильная

### Pillow 11.0.0
- **Обоснование:** Актуальная версия для обработки изображений
- **Совместимость:** Python 3.9+
- **Важно:** Security-critical, частые CVE
- **Обновление:** Оперативно при security патчах

## Testing

### pytest 8.4.2
- **Обоснование:** Последняя стабильная
- **Совместимость:** Python 3.9-3.14
- **Обновление:** Стабильная, обновления безопасны

### pytest-asyncio 1.2.0
- **Обоснование:** Последняя версия с поддержкой async тестов
- **Важно:**
  - v1.0.0+ убрал `event_loop` fixture
  - Новый подход к async testing
- **Совместимость:** Python 3.9+, pytest 7.0+
- **Обновление:** Проверять breaking changes в 1.x

### pytest-cov 6.0.0
- **Обоснование:** Coverage integration для pytest
- **Совместимость:** Python 3.9+
- **Обновление:** Стабильная

## Code Quality

### Ruff 0.9.1
- **Обоснование:** Fastest Python linter (замена flake8/pylint)
- **Совместимость:** Python 3.7+
- **Обновление:** Активная разработка, обновления часто

### Black 24.10.0
- **Обоснование:** Стандартный formatter
- **Совместимость:** Python 3.9+
- **Обновление:** Стабильная, обновления безопасны

### mypy 1.14.1
- **Обоснование:** Type checking
- **Совместимость:** Python 3.9+
- **Обновление:** Регулярные, улучшения type inference

## Критические ограничения

### ⚠️ НЕ обновлять

1. **redis > 5.2.1** - несовместимость с Kombu/Celery
   - Ждать обновления Kombu с поддержкой redis 5.3+

### ⚠️ Deprecated библиотеки

1. **python-jose** ❌ Заменена на PyJWT
   - Заброшена с 2021
   - Несовместима с Python 3.10+
   - Использовать PyJWT 2.10+

### ✅ Приоритет обновлений

1. **Security-critical** (немедленно):
   - PyJWT
   - passlib
   - Pillow
   - cryptography (dependency)

2. **High priority** (в течение недели):
   - FastAPI
   - SQLAlchemy
   - Pydantic

3. **Normal priority** (в течение месяца):
   - Остальные библиотеки

## Процедура обновления

1. **Проверка совместимости:**
   ```bash
   pip install -U <package>==<new_version>
   pip check  # Проверка зависимостей
   ```

2. **Локальное тестирование:**
   ```bash
   pytest tests/  # Все тесты должны пройти
   ruff check .   # Lint
   mypy app/      # Type checking
   ```

3. **Обновление requirements.txt:**
   - Добавить комментарий с обоснованием версии
   - Обновить этот документ

4. **CI/CD:**
   - Проверить прохождение pipeline
   - Развернуть на staging
   - Проверить интеграционные тесты

## Ссылки для мониторинга

- [FastAPI Release Notes](https://fastapi.tiangolo.com/release-notes/)
- [Pydantic Changelog](https://docs.pydantic.dev/latest/changelog/)
- [SQLAlchemy Changelog](https://docs.sqlalchemy.org/en/20/changelog/)
- [Celery Releases](https://github.com/celery/celery/releases)
- [Python Security Advisories](https://pypi.org/security/)

## Контакты для вопросов

При возникновении проблем с зависимостями:
1. Проверить GitHub Issues библиотеки
2. Проверить совместимость на [PyPI](https://pypi.org/)
3. Откатиться на предыдущую версию
4. Создать issue с деталями проблемы
