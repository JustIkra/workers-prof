import{n as C,m as h,z as R,q as D,w as a,E as c,e as A,r as n,A as E,o as k,a as f,d as t,B as N,f as g,u,C as T,D as L,F as j}from"./index-B_nAfbqS.js";import{A as G}from"./AppLayout-BPUf2_RP.js";import{u as H}from"./participants-vWZuwwuo.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"participants-view"},O={class:"header-content"},Q={class:"actions-group"},W={class:"pagination"},X={__name:"ParticipantsView",setup(Z){const z=A(),i=H(),r=C({query:"",external_id:"",page:1,size:20}),p=h(!1),y=h(null),o=C({full_name:"",birth_date:"",external_id:""}),P={full_name:[{required:!0,message:"Введите ФИО",trigger:"blur"},{min:1,max:255,message:"От 1 до 255 символов",trigger:"blur"}]},d=async()=>{try{await i.searchParticipants(r)}catch{c.error("Ошибка загрузки участников")}},U=async()=>{y.value&&await y.value.validate(async s=>{if(s)try{await i.createParticipant(o),c.success("Участник создан"),p.value=!1,o.full_name="",o.birth_date="",o.external_id="",await d()}catch{c.error(i.error||"Ошибка создания участника")}})},Y=s=>{z.push(`/participants/${s}`)},B=s=>{j.confirm(`Вы уверены, что хотите удалить участника "${s.full_name}"?`,"Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}).then(async()=>{try{await i.deleteParticipant(s.id),c.success("Участник удалён"),await d()}catch{c.error(i.error||"Ошибка удаления участника")}}).catch(()=>{})};return R(()=>{d()}),(s,e)=>{const V=n("el-icon"),m=n("el-button"),x=n("el-card"),b=n("el-input"),_=n("el-form-item"),w=n("el-form"),v=n("el-table-column"),M=n("el-table"),$=n("el-pagination"),q=n("el-date-picker"),F=n("el-dialog"),I=E("loading");return k(),D(G,null,{default:a(()=>[f("div",K,[t(x,{class:"header-card"},{default:a(()=>[f("div",O,[e[11]||(e[11]=f("h1",null,"Участники",-1)),t(m,{type:"primary",onClick:e[0]||(e[0]=l=>p.value=!0)},{default:a(()=>[t(V,null,{default:a(()=>[t(u(T))]),_:1}),e[10]||(e[10]=g(" Добавить участника ",-1))]),_:1})])]),_:1}),t(x,{class:"search-card"},{default:a(()=>[t(w,{inline:!0,model:r},{default:a(()=>[t(_,{label:"Поиск"},{default:a(()=>[t(b,{modelValue:r.query,"onUpdate:modelValue":e[1]||(e[1]=l=>r.query=l),placeholder:"Введите имя",clearable:"",style:{width:"300px"},onChange:d},{prefix:a(()=>[t(V,null,{default:a(()=>[t(u(L))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"Внешний ID"},{default:a(()=>[t(b,{modelValue:r.external_id,"onUpdate:modelValue":e[2]||(e[2]=l=>r.external_id=l),placeholder:"Внешний ID",clearable:"",style:{width:"200px"},onChange:d},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),N((k(),D(x,{class:"table-card"},{default:a(()=>[t(M,{data:u(i).participants,stripe:""},{default:a(()=>[t(v,{prop:"full_name",label:"ФИО","min-width":"200"}),t(v,{prop:"birth_date",label:"Дата рождения",width:"150"}),t(v,{prop:"external_id",label:"Внешний ID",width:"150"}),t(v,{label:"Действия",width:"180",fixed:"right"},{default:a(({row:l})=>[f("div",Q,[t(m,{type:"primary",size:"small",onClick:S=>Y(l.id)},{default:a(()=>[...e[12]||(e[12]=[g(" Открыть ",-1)])]),_:1},8,["onClick"]),t(m,{class:"actions-group__danger",type:"danger",size:"small",onClick:S=>B(l)},{default:a(()=>[...e[13]||(e[13]=[g(" Удалить ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"]),f("div",W,[t($,{"current-page":r.page,"onUpdate:currentPage":e[3]||(e[3]=l=>r.page=l),"page-size":r.size,"onUpdate:pageSize":e[4]||(e[4]=l=>r.size=l),total:u(i).pagination.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onCurrentChange:d,onSizeChange:d},null,8,["current-page","page-size","total"])])]),_:1})),[[I,u(i).loading]]),t(F,{modelValue:p.value,"onUpdate:modelValue":e[9]||(e[9]=l=>p.value=l),title:"Добавить участника",width:"500px"},{footer:a(()=>[t(m,{onClick:e[8]||(e[8]=l=>p.value=!1)},{default:a(()=>[...e[14]||(e[14]=[g(" Отмена ",-1)])]),_:1}),t(m,{type:"primary",loading:u(i).loading,onClick:U},{default:a(()=>[...e[15]||(e[15]=[g(" Создать ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(w,{ref_key:"createFormRef",ref:y,model:o,rules:P,"label-position":"top"},{default:a(()=>[t(_,{label:"ФИО",prop:"full_name"},{default:a(()=>[t(b,{modelValue:o.full_name,"onUpdate:modelValue":e[5]||(e[5]=l=>o.full_name=l),placeholder:"Введите полное имя"},null,8,["modelValue"])]),_:1}),t(_,{label:"Дата рождения",prop:"birth_date"},{default:a(()=>[t(q,{modelValue:o.birth_date,"onUpdate:modelValue":e[6]||(e[6]=l=>o.birth_date=l),type:"date",placeholder:"Выберите дату",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(_,{label:"Внешний ID",prop:"external_id"},{default:a(()=>[t(b,{modelValue:o.external_id,"onUpdate:modelValue":e[7]||(e[7]=l=>o.external_id=l),placeholder:"Внешний идентификатор (необязательно)"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),_:1})}}},oe=J(X,[["__scopeId","data-v-89d163df"]]);export{oe as default};
