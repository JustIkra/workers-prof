import{x,r as C,a as L,y as M,n as X,f as j,E as g,e as z,g as P,w as t,d as a,p as G,o as D,q as H,c as J,h as K,b as o,l as d,j as l,z as f,i as V,A as Q}from"./index-Doc1gm_3.js";import{A as W}from"./AppLayout-DW9BSC31.js";import{u as Y}from"./participants-C6c_ZwqW.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={async upload(m,u,v){const n=new FormData;return n.append("report_type",u),n.append("file",v),(await x.post(`/participants/${m}/reports`,n,{headers:{"Content-Type":"multipart/form-data"}})).data},async download(m){return await x.get(`/reports/${m}/download`,{responseType:"blob"})}},te={class:"participant-detail"},oe={class:"card-header"},ae={class:"reports-section"},le={class:"section-header"},re={__name:"ParticipantDetailView",setup(m){const u=z(),v=j(),n=Y(),s=C(!1),b=C(!1),w=C(null),r=L({report_type:"",file:null}),E={report_type:[{required:!0,message:"Выберите тип отчёта",trigger:"change"}],file:[{required:!0,message:"Выберите файл",trigger:"change"}]},i=M(()=>n.currentParticipant),T=_=>{r.file=_.raw},A=async()=>{w.value&&await w.value.validate(async _=>{if(_){if(!r.file){g.error("Выберите файл");return}b.value=!0;try{await ee.upload(v.params.id,r.report_type,r.file),g.success("Отчёт загружен успешно"),s.value=!1,r.report_type="",r.file=null}catch{g.error("Ошибка загрузки отчёта")}finally{b.value=!1}}})};return X(async()=>{try{await n.getParticipant(v.params.id)}catch{g.error("Участник не найден"),u.push("/participants")}}),(_,e)=>{const c=a("el-button"),y=a("el-descriptions-item"),F=a("el-descriptions"),O=a("el-divider"),U=a("el-icon"),$=a("el-alert"),B=a("el-card"),R=a("el-option"),N=a("el-select"),k=a("el-form-item"),S=a("el-upload"),h=a("el-form"),q=a("el-dialog"),I=G("loading");return D(),P(W,null,{default:t(()=>[H((D(),J("div",te,[i.value?(D(),P(B,{key:0,class:"detail-card"},{header:t(()=>[d("div",oe,[d("h2",null,f(i.value.full_name),1),o(c,{onClick:e[0]||(e[0]=p=>V(u).back())},{default:t(()=>[...e[5]||(e[5]=[l("Назад",-1)])]),_:1})])]),default:t(()=>[o(F,{column:2,border:""},{default:t(()=>[o(y,{label:"ФИО"},{default:t(()=>[l(f(i.value.full_name),1)]),_:1}),o(y,{label:"Дата рождения"},{default:t(()=>[l(f(i.value.birth_date||"Не указана"),1)]),_:1}),o(y,{label:"Внешний ID"},{default:t(()=>[l(f(i.value.external_id||"Не указан"),1)]),_:1}),o(y,{label:"Дата создания"},{default:t(()=>[l(f(new Date(i.value.created_at).toLocaleString("ru-RU")),1)]),_:1})]),_:1}),o(O),d("div",ae,[d("div",le,[e[7]||(e[7]=d("h3",null,"Отчёты",-1)),o(c,{type:"primary",onClick:e[1]||(e[1]=p=>s.value=!0)},{default:t(()=>[o(U,null,{default:t(()=>[o(V(Q))]),_:1}),e[6]||(e[6]=l(" Загрузить отчёт ",-1))]),_:1})]),o($,{title:"Отчёты участника будут отображаться здесь",type:"info",closable:!1,"show-icon":"",style:{"margin-top":"20px"}},{default:t(()=>[...e[8]||(e[8]=[l(" Функционал отображения списка отчётов будет добавлен после реализации соответствующих API эндпоинтов ",-1)])]),_:1})])]),_:1})):K("",!0),o(q,{modelValue:s.value,"onUpdate:modelValue":e[4]||(e[4]=p=>s.value=p),title:"Загрузить отчёт",width:"500px"},{footer:t(()=>[o(c,{onClick:e[3]||(e[3]=p=>s.value=!1)},{default:t(()=>[...e[11]||(e[11]=[l("Отмена",-1)])]),_:1}),o(c,{type:"primary",loading:b.value,onClick:A},{default:t(()=>[...e[12]||(e[12]=[l(" Загрузить ",-1)])]),_:1},8,["loading"])]),default:t(()=>[o(h,{ref_key:"uploadFormRef",ref:w,model:r,rules:E,"label-position":"top"},{default:t(()=>[o(k,{label:"Тип отчёта",prop:"report_type"},{default:t(()=>[o(N,{modelValue:r.report_type,"onUpdate:modelValue":e[2]||(e[2]=p=>r.report_type=p),placeholder:"Выберите тип",style:{width:"100%"}},{default:t(()=>[o(R,{label:"Отчёт 1",value:"REPORT_1"}),o(R,{label:"Отчёт 2",value:"REPORT_2"}),o(R,{label:"Отчёт 3",value:"REPORT_3"})]),_:1},8,["modelValue"])]),_:1}),o(k,{label:"Файл (DOCX)",prop:"file"},{default:t(()=>[o(S,{ref:"uploadRef","auto-upload":!1,limit:1,accept:".docx","on-change":T},{tip:t(()=>[...e[10]||(e[10]=[d("div",{class:"el-upload__tip"},"Только файлы DOCX",-1)])]),default:t(()=>[o(c,{type:"primary"},{default:t(()=>[...e[9]||(e[9]=[l("Выбрать файл",-1)])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])),[[I,V(n).loading]])]),_:1})}}},de=Z(re,[["__scopeId","data-v-c17a4991"]]);export{de as default};
