import{G as z,m as f,H as Q,I as ke,r as m,c as k,o as r,d as a,v as O,J as We,w as t,u as A,K as Ye,C as Ze,L as et,M as y,N as H,z as De,q as b,f as c,O as K,a as p,E as w,n as $e,P as tt,p as at,e as lt,A as nt,B as ue,t as ot,Q as Ae,h as st,R as Oe,S as rt,T as it,U as ut,V as dt,W as ct,X as pt,F as mt}from"./index-Db0RtKnA.js";import{A as ft}from"./AppLayout-DqVd2p56.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{m as he,p as _t}from"./metrics-XI7SfwXr.js";import{u as vt,p as Le}from"./participants-MZZRgY66.js";const de={async upload(s,_,o){const g=new FormData;return g.append("report_type",_),g.append("file",o),(await z.post(`/participants/${s}/reports`,g,{headers:{"Content-Type":"multipart/form-data"}})).data},async download(s){return await z.get(`/reports/${s}/download`,{responseType:"blob"})},async getById(s){return(await z.get(`/reports/${s}`)).data},async delete(s){return(await z.delete(`/reports/${s}`)).data},async extract(s){return(await z.post(`/reports/${s}/extract`)).data},async getMetrics(s){return(await z.get(`/reports/${s}/metrics`)).data},async getList(s){return(await z.get(`/participants/${s}/reports`)).data}},ce={async calculate(s,_){return(await z.post(`/scoring/participants/${s}/calculate`,null,{params:{activity_code:_}})).data},async getHistory(s,_=10){return(await z.get(`/scoring/participants/${s}/scores`,{params:{limit:_}})).data},async getById(s){return(await z.get(`/scoring-results/${s}`)).data},async generateRecommendations(s){return(await z.post(`/reports/${s}/recommendations`)).data},async getFinalReport(s,_,o="json"){const g={params:{activity_code:_,format:o}};o==="html"&&(g.responseType="text");const I=await z.get(`/participants/${s}/final-report`,g);return I.data}};function pe(s,_=1){if(s==null||s==="")return"";const o=typeof s=="string"?parseFloat(s):s;return isNaN(o)?"":o.toLocaleString("ru-RU",{minimumFractionDigits:_,maximumFractionDigits:_})}function Y(s){if(s==null||s==="")return null;const o=String(s).trim().replace(",","."),g=parseFloat(o);return isNaN(g)?null:g}function yt(s){return Y(s)}function le(s,_=1){return pe(s,_)}const gt={key:0,class:"error-message"},wt={__name:"MetricInput",props:{modelValue:{type:[Number,String],default:null},min:{type:Number,default:1},max:{type:Number,default:10},step:{type:Number,default:.1},precision:{type:Number,default:1},placeholder:{type:String,default:"Введите значение"},disabled:{type:Boolean,default:!1},showControls:{type:Boolean,default:!0}},emits:["update:modelValue","change","blur"],setup(s,{emit:_}){const o=s,g=_,I=f(null),E=f(""),D=f(!1),C=f(!1),U=f(""),M=Q(()=>Y(E.value)),V=Q(()=>{const d=M.value;return d===null||d<=o.min}),P=Q(()=>{const d=M.value;return d===null||d>=o.max}),F=d=>{if(d==null||d===""){E.value="";return}D.value?E.value=String(d).replace(".",","):E.value=pe(d,o.precision)},X=d=>{if(d==null||d==="")return C.value=!1,U.value="",!0;const h=Y(d);return h===null?(C.value=!0,U.value="Некорректное число",!1):h<o.min?(C.value=!0,U.value=`Значение должно быть не меньше ${pe(o.min,o.precision)}`,!1):h>o.max?(C.value=!0,U.value=`Значение должно быть не больше ${pe(o.max,o.precision)}`,!1):(C.value=!1,U.value="",!0)},q=d=>{const h=d.replace(/[^\d,.-]/g,"");let R=!1;const i=h.split("").filter($=>$===","||$==="."?R?!1:(R=!0,!0):!0).join("").replace(".",",");E.value=i;const u=Y(i);u!==null?g("update:modelValue",u):(i===""||i==="-")&&g("update:modelValue",null)},B=()=>{D.value=!1;const d=Y(E.value);if(X(E.value)){if(d!==null){const h=Math.round(d*Math.pow(10,o.precision))/Math.pow(10,o.precision),R=Math.max(o.min,Math.min(o.max,h));g("update:modelValue",R),F(R),g("change",R)}}else if(d!==null&&(d<o.min||d>o.max)){const h=Math.max(o.min,Math.min(o.max,d));g("update:modelValue",h),F(h),g("change",h),C.value=!1,U.value=""}g("blur")},j=()=>{D.value=!0,M.value!==null&&(E.value=String(M.value).replace(".",","))},Z=()=>{const d=M.value||0,h=Math.min(o.max,d+o.step),R=Math.round(h*Math.pow(10,o.precision))/Math.pow(10,o.precision);g("update:modelValue",R),g("change",R),F(R)},J=()=>{const d=M.value||0,h=Math.max(o.min,d-o.step),R=Math.round(h*Math.pow(10,o.precision))/Math.pow(10,o.precision);g("update:modelValue",R),g("change",R),F(R)};return ke(()=>o.modelValue,d=>{F(d)},{immediate:!0}),F(o.modelValue),(d,h)=>{const R=m("el-button"),i=m("el-button-group"),u=m("el-input");return r(),k(H,null,[a(u,{ref_key:"inputRef",ref:I,modelValue:E.value,"onUpdate:modelValue":h[0]||(h[0]=$=>E.value=$),placeholder:s.placeholder,disabled:s.disabled,class:et({"is-invalid":C.value}),onInput:q,onBlur:B,onFocus:j},We({_:2},[s.showControls?{name:"append",fn:t(()=>[a(i,null,{default:t(()=>[a(R,{icon:A(Ye),disabled:s.disabled||V.value,onClick:J},null,8,["icon","disabled"]),a(R,{icon:A(Ze),disabled:s.disabled||P.value,onClick:Z},null,8,["icon","disabled"])]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder","disabled","class"]),C.value?(r(),k("div",gt,y(U.value),1)):O("",!0)],64)}}},bt=Ce(wt,[["__scopeId","data-v-74ef628d"]]),ht={class:"card-header"},kt={key:1},Ct={key:0,class:"metric-description"},Rt={key:2,class:"metrics-info"},Mt={class:"info-row"},St={key:0,class:"info-row"},xt={__name:"MetricsEditor",props:{reportId:{type:String,required:!0}},emits:["metrics-updated"],setup(s,{emit:_}){const o=s,g=_,I=f(!1),E=f(!1),D=f(!1),C=f(null),U=f([]),M=f([]),V=f({metrics:{}}),P=f({}),F=Q(()=>!M.value||M.value.length===0?[]:[...new Set(M.value.map(i=>i.source))]),X=Q(()=>!M.value||M.value.length===0?null:new Date),q=async()=>{try{const i=await he.listMetricDefs(!0);U.value=i.items||[]}catch(i){console.error("Failed to load metric definitions:",i),C.value="Не удалось загрузить определения метрик"}},B=async()=>{I.value=!0,C.value=null;try{const i=await he.listExtractedMetrics(o.reportId);M.value=i.items||[],V.value.metrics={},M.value.forEach(u=>{V.value.metrics[u.metric_def_id]=Y(u.value)}),P.value=JSON.parse(JSON.stringify(V.value.metrics))}catch(i){console.error("Failed to load metrics:",i),C.value="Не удалось загрузить метрики"}finally{I.value=!1}},j=()=>{D.value=!0,P.value=JSON.parse(JSON.stringify(V.value.metrics))},Z=()=>{V.value.metrics=JSON.parse(JSON.stringify(P.value)),D.value=!1,C.value=null},J=async()=>{E.value=!0,C.value=null;try{const i=[];for(const[u,$]of Object.entries(V.value.metrics))if($!=null&&$!==""){const N=yt($);N!==null&&i.push({metric_def_id:u,value:N,source:"MANUAL",notes:null})}if(i.length===0){w.warning("Не введено ни одного значения метрики"),E.value=!1;return}await he.bulkCreateExtractedMetrics(o.reportId,i),w.success(`Успешно сохранено ${i.length} метрик`),D.value=!1,await B(),g("metrics-updated")}catch(i){console.error("Failed to save metrics:",i);let u="Не удалось сохранить метрики";i.response?.data?.detail&&(typeof i.response.data.detail=="string"?u=i.response.data.detail:Array.isArray(i.response.data.detail)&&(u=i.response.data.detail.map($=>$.msg||$.message).join(", "))),C.value=u,w.error(u)}finally{E.value=!1}},d=i=>{switch(i){case"OCR":return"info";case"LLM":return"warning";case"MANUAL":return"success";default:return""}},h=i=>{switch(i){case"OCR":return"OCR";case"LLM":return"Gemini Vision";case"MANUAL":return"Ручной ввод";default:return i}},R=i=>new Date(i).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return De(async()=>{await q(),await B()}),ke(()=>o.reportId,async i=>{i&&await B()}),(i,u)=>{const $=m("el-button"),N=m("el-alert"),W=m("el-form-item"),ne=m("el-col"),me=m("el-row"),fe=m("el-form"),_e=m("el-divider"),ve=m("el-tag"),ye=m("el-card");return r(),b(ye,{class:"metrics-editor"},{header:t(()=>[p("div",ht,[u[4]||(u[4]=p("span",null,"Ручной ввод метрик",-1)),D.value?(r(),k("div",kt,[a($,{size:"small",onClick:Z},{default:t(()=>[...u[2]||(u[2]=[c(" Отмена ",-1)])]),_:1}),a($,{type:"primary",size:"small",loading:E.value,onClick:J},{default:t(()=>[...u[3]||(u[3]=[c(" Сохранить ",-1)])]),_:1},8,["loading"])])):(r(),b($,{key:0,type:"primary",size:"small",onClick:j},{default:t(()=>[...u[1]||(u[1]=[c(" Редактировать ",-1)])]),_:1}))])]),default:t(()=>[C.value?(r(),b(N,{key:0,type:"error",title:C.value,closable:"",style:{"margin-bottom":"16px"},onClose:u[0]||(u[0]=S=>C.value=null)},null,8,["title"])):O("",!0),!M.value||M.value.length===0?(r(),b(N,{key:1,type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:t(()=>[...u[5]||(u[5]=[c(" Метрики для этого отчёта ещё не извлечены. Вы можете ввести их вручную. ",-1)])]),_:1})):O("",!0),a(fe,{ref:"formRef",model:V.value,"label-position":"top",disabled:!D.value},{default:t(()=>[a(me,{gutter:20},{default:t(()=>[(r(!0),k(H,null,K(U.value,S=>(r(),b(ne,{key:S.id,xs:24,sm:12,md:8,lg:6},{default:t(()=>[a(W,{label:`${S.name} ${S.unit?"("+S.unit+")":""}`,prop:`metrics.${S.id}`},{default:t(()=>[a(bt,{modelValue:V.value.metrics[S.id],"onUpdate:modelValue":ge=>V.value.metrics[S.id]=ge,min:S.min_value||1,max:S.max_value||10,precision:1,step:.1,disabled:!D.value,"show-controls":!0,placeholder:"Введите значение (например: 7,5)"},null,8,["modelValue","onUpdate:modelValue","min","max","disabled"]),S.description?(r(),k("div",Ct,y(S.description),1)):O("",!0)]),_:2},1032,["label","prop"])]),_:2},1024))),128))]),_:1})]),_:1},8,["model","disabled"]),M.value&&M.value.length>0?(r(),k("div",Rt,[a(_e),p("div",Mt,[u[6]||(u[6]=p("span",{class:"info-label"},"Источник данных:",-1)),(r(!0),k(H,null,K(F.value,S=>(r(),b(ve,{key:S,type:d(S),size:"small",style:{"margin-left":"8px"}},{default:t(()=>[c(y(h(S)),1)]),_:2},1032,["type"]))),128))]),X.value?(r(),k("div",St,[u[7]||(u[7]=p("span",{class:"info-label"},"Последнее обновление:",-1)),p("span",null,y(R(X.value)),1)])):O("",!0)])):O("",!0)]),_:1})}}},Et=Ce(xt,[["__scopeId","data-v-bb0e5e9d"]]),Vt={class:"participant-detail"},$t={class:"card-header"},At={class:"header-actions"},Ot={class:"section-header"},Lt={class:"actions-group"},Dt={class:"section-header"},Ut={key:1},Nt={key:1},Ft={class:"scoring-result"},Tt={class:"score-value"},It={class:"score-number"},Pt={class:"score-details"},zt={class:"score-section"},Bt={key:0},jt={class:"score-section"},Jt={key:0},Gt={key:0,class:"score-section"},Ht={key:0,class:"final-report-actions"},Xt={style:{float:"right",color:"#8492a6","font-size":"13px"}},qt={__name:"ParticipantDetailView",setup(s){const _=lt(),o=at(),g=vt(),I=f(!1),E=f(!1),D=f(!1),C=f(!1),U=f(!1),M=f(!1),V=Q(()=>g.currentParticipant),P=f([]),F=f([]),X=f([]),q=f([]);f([]);const B=f(null),j=f(null),Z=Q(()=>P.value.some(l=>l.status==="PROCESSING")),J=f(!1),d=f(!1),h=f(!1),R=f(null),i=f([]),u=$e({report_type:"",file:null}),$={report_type:[{required:!0,message:"Выберите тип отчёта",trigger:"change"}],file:[{required:!0,message:"Выберите файл",trigger:"change"}]},N=$e({activityCode:""}),W=l=>l?new Date(l).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",ne=l=>({REPORT_1:"Отчёт 1",REPORT_2:"Отчёт 2",REPORT_3:"Отчёт 3"})[l]||l,me=l=>({UPLOADED:"Загружен",PROCESSING:"Извлечение метрик...",EXTRACTED:"Метрики извлечены",FAILED:"Ошибка"})[l]||l,fe=l=>({UPLOADED:"info",PROCESSING:"warning",EXTRACTED:"success",FAILED:"danger"})[l]||"info",_e=l=>l>=80?"success":l>=60?"":"warning",ve=l=>l>=.8?"#67C23A":l>=.6?"#E6A23C":"#F56C6C",ye=async()=>{I.value=!0;try{await g.getParticipant(o.params.id)}catch{w.error("Участник не найден"),_.push("/participants")}finally{I.value=!1}},S=async()=>{E.value=!0;try{const l=await Le.getReports(o.params.id);P.value=l.items||[]}catch(l){console.error("Error loading reports:",l),w.error("Ошибка загрузки списка отчётов")}finally{E.value=!1}},ge=async()=>{try{const l=await ce.getHistory(o.params.id);F.value=l.items||[]}catch(l){console.error("Error loading scoring results:",l)}},Ue=async()=>{D.value=!0;try{const l=await _t.list();X.value=l.activities||[]}catch{w.error("Ошибка загрузки профессиональных областей")}finally{D.value=!1}},ee=async()=>{C.value=!0;try{const l=await Le.getMetrics(o.params.id);q.value=l.metrics||[]}catch(l){console.error("Error loading participant metrics:",l),w.error("Ошибка загрузки метрик участника")}finally{C.value=!1}},Ne=l=>{u.file=l.raw,i.value=[l]},Fe=async()=>{R.value&&await R.value.validate(async l=>{if(l){if(!u.file){w.error("Выберите файл");return}U.value=!0;try{await de.upload(o.params.id,u.report_type,u.file),w.success("Отчёт загружен успешно"),J.value=!1,u.report_type="",u.file=null,i.value=[],await S(),await ee()}catch{w.error("Ошибка загрузки отчёта")}finally{U.value=!1}}})},Te=async l=>{try{const e=await de.download(l),v=window.URL.createObjectURL(new Blob([e.data])),x=document.createElement("a");x.href=v,x.setAttribute("download",`report_${l}.docx`),document.body.appendChild(x),x.click(),x.remove(),window.URL.revokeObjectURL(v),w.success("Отчёт скачан")}catch{w.error("Ошибка скачивания отчёта")}},Ie=async l=>{try{await de.extract(l),w.success("Извлечение метрик запущено"),await S()}catch{w.error("Ошибка запуска извлечения метрик")}},Pe=()=>{j.value||(j.value=setInterval(async()=>{try{await S(),await ee()}catch(l){console.error("Auto-refresh error:",l)}},3e3))},Re=()=>{j.value&&(clearInterval(j.value),j.value=null)};ke(Z,l=>{l?Pe():Re()});const Me=async l=>{B.value=l,await pt(),h.value=!0},ze=async()=>{w.success("Метрики обновлены"),await ee()},Be=l=>{mt.confirm(`Вы уверены, что хотите удалить отчёт "${ne(l.type)}"?`,"Подтверждение удаления",{confirmButtonText:"Удалить",cancelButtonText:"Отмена",type:"warning"}).then(async()=>{try{await de.delete(l.id),w.success("Отчёт удалён"),await S()}catch{w.error("Ошибка удаления отчёта")}}).catch(()=>{})},je=async()=>{if(!N.activityCode){w.warning("Выберите профессиональную область");return}M.value=!0;try{const l=await ce.calculate(o.params.id,N.activityCode);F.value.unshift({id:l.scoring_result_id,prof_activity_code:l.prof_activity_code||N.activityCode,prof_activity_name:l.prof_activity_name,score_pct:parseFloat(l.score_pct),strengths:l.strengths||[],dev_areas:l.dev_areas||[],recommendations:l.recommendations||[],created_at:new Date().toISOString()}),w.success("Расчёт пригодности выполнен"),d.value=!1,N.activityCode=""}catch(l){console.error("Scoring calculation error:",l);const e=l.response?.data?.detail||"Ошибка расчёта пригодности";w.error(e)}finally{M.value=!1}},Je=async l=>{if(!l.prof_activity_code){w.warning("Код профессиональной деятельности не найден");return}try{const e=await ce.getFinalReport(o.params.id,l.prof_activity_code,"json"),v=JSON.stringify(e,null,2),x=new Blob([v],{type:"application/json"}),T=window.URL.createObjectURL(x);window.open(T,"_blank"),window.URL.revokeObjectURL(T),w.success("Отчёт JSON открыт в новой вкладке")}catch(e){console.error("Error viewing final report JSON:",e);const v=e.response?.data?.detail||"Ошибка загрузки финального отчёта";w.error(v)}},Ge=async l=>{if(!l.prof_activity_code){w.warning("Код профессиональной деятельности не найден");return}try{const e=await ce.getFinalReport(o.params.id,l.prof_activity_code,"html"),v=new Blob([e],{type:"text/html"}),x=window.URL.createObjectURL(v),T=document.createElement("a");T.href=x,T.setAttribute("download",`final_report_${l.prof_activity_code}_${new Date().toISOString().split("T")[0]}.html`),document.body.appendChild(T),T.click(),T.remove(),window.URL.revokeObjectURL(x),w.success("Отчёт HTML скачан")}catch(e){console.error("Error downloading final report HTML:",e);const v=e.response?.data?.detail||"Ошибка загрузки финального отчёта";w.error(v)}};return De(async()=>{await ye(),await S(),await ge(),await Ue(),await ee()}),tt(()=>{Re()}),(l,e)=>{const v=m("el-button"),x=m("el-icon"),T=m("el-descriptions-item"),He=m("el-descriptions"),te=m("el-card"),oe=m("el-tag"),G=m("el-table-column"),Se=m("el-table"),se=m("el-empty"),Xe=m("el-progress"),qe=m("el-timeline-item"),Ke=m("el-timeline"),re=m("el-option"),xe=m("el-select"),we=m("el-form-item"),Qe=m("el-upload"),Ee=m("el-form"),be=m("el-dialog"),Ve=m("el-alert"),ie=nt("loading");return r(),b(ft,null,{default:t(()=>[ue((r(),k("div",Vt,[V.value?(r(),b(te,{key:0,class:"detail-card"},{header:t(()=>[p("div",$t,[p("h2",null,y(V.value.full_name),1),p("div",At,[a(v,{onClick:e[0]||(e[0]=n=>A(_).back())},{default:t(()=>[...e[10]||(e[10]=[c(" Назад ",-1)])]),_:1}),a(v,{type:"primary",onClick:e[1]||(e[1]=n=>d.value=!0)},{default:t(()=>[a(x,null,{default:t(()=>[a(A(ot))]),_:1}),e[11]||(e[11]=c(" Рассчитать пригодность ",-1))]),_:1})])])]),default:t(()=>[a(He,{column:2,border:""},{default:t(()=>[a(T,{label:"ФИО"},{default:t(()=>[c(y(V.value.full_name),1)]),_:1}),a(T,{label:"Дата рождения"},{default:t(()=>[c(y(V.value.birth_date||"Не указана"),1)]),_:1}),a(T,{label:"Внешний ID"},{default:t(()=>[c(y(V.value.external_id||"Не указан"),1)]),_:1}),a(T,{label:"Дата создания"},{default:t(()=>[c(y(W(V.value.created_at)),1)]),_:1})]),_:1})]),_:1})):O("",!0),a(te,{class:"section-card"},{header:t(()=>[p("div",Ot,[e[13]||(e[13]=p("h3",null,"Отчёты",-1)),a(v,{type:"primary",onClick:e[2]||(e[2]=n=>J.value=!0)},{default:t(()=>[a(x,null,{default:t(()=>[a(A(it))]),_:1}),e[12]||(e[12]=c(" Загрузить отчёт ",-1))]),_:1})])]),default:t(()=>[ue((r(),b(Se,{data:P.value,stripe:""},{default:t(()=>[a(G,{prop:"type",label:"Тип",width:"120"},{default:t(({row:n})=>[a(oe,null,{default:t(()=>[c(y(ne(n.type)),1)]),_:2},1024)]),_:1}),a(G,{prop:"status",label:"Статус",width:"150"},{default:t(({row:n})=>[a(oe,{type:fe(n.status)},{default:t(()=>[c(y(me(n.status)),1)]),_:2},1032,["type"])]),_:1}),a(G,{prop:"created_at",label:"Дата загрузки",width:"180"},{default:t(({row:n})=>[c(y(W(n.created_at)),1)]),_:1}),a(G,{label:"Действия",width:"450",fixed:"right"},{default:t(({row:n})=>[p("div",Lt,[a(v,{size:"small",onClick:L=>Te(n.id)},{default:t(()=>[a(x,null,{default:t(()=>[a(A(Ae))]),_:1}),e[14]||(e[14]=c(" Скачать ",-1))]),_:1},8,["onClick"]),n.status==="UPLOADED"||n.status==="FAILED"?(r(),b(v,{key:0,size:"small",type:"primary",onClick:L=>Ie(n.id)},{default:t(()=>[a(x,null,{default:t(()=>[a(A(st))]),_:1}),c(" "+y(n.status==="FAILED"?"Повторить":"Извлечь метрики"),1)]),_:2},1032,["onClick"])):O("",!0),n.status==="PROCESSING"?(r(),b(v,{key:1,size:"small",type:"primary",loading:!0,disabled:""},{default:t(()=>[...e[15]||(e[15]=[c(" Извлечение... ",-1)])]),_:1})):O("",!0),n.status==="EXTRACTED"?(r(),b(v,{key:2,size:"small",type:"success",onClick:L=>Me(n.id)},{default:t(()=>[a(x,null,{default:t(()=>[a(A(Oe))]),_:1}),e[16]||(e[16]=c(" Редактировать метрики ",-1))]),_:1},8,["onClick"])):O("",!0),n.status==="PROCESSING"||n.status==="EXTRACTED"?(r(),b(v,{key:3,size:"small",type:"info",onClick:L=>Me(n.id)},{default:t(()=>[a(x,null,{default:t(()=>[a(A(Oe))]),_:1}),e[17]||(e[17]=c(" Просмотр ",-1))]),_:1},8,["onClick"])):O("",!0),a(v,{size:"small",type:"danger",onClick:L=>Be(n)},{default:t(()=>[a(x,null,{default:t(()=>[a(A(rt))]),_:1})]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ie,E.value]]),!P.value.length&&!E.value?(r(),b(se,{key:0,description:"Нет загруженных отчётов"})):O("",!0)]),_:1}),a(te,{class:"section-card"},{header:t(()=>[p("div",Dt,[e[19]||(e[19]=p("h3",null,"Актуальные метрики участника",-1)),a(v,{type:"primary",size:"small",onClick:ee},{default:t(()=>[a(x,null,{default:t(()=>[a(A(dt))]),_:1}),e[18]||(e[18]=c(" Обновить ",-1))]),_:1})])]),default:t(()=>[ue((r(),b(Se,{data:q.value,stripe:""},{default:t(()=>[a(G,{prop:"metric_code",label:"Код метрики",width:"200"}),a(G,{prop:"value",label:"Значение",width:"120"},{default:t(({row:n})=>[a(oe,{type:"success"},{default:t(()=>[c(y(A(le)(n.value)),1)]),_:2},1024)]),_:1}),a(G,{prop:"confidence",label:"Уверенность",width:"150"},{default:t(({row:n})=>[n.confidence!==null?(r(),k("span",{key:0,style:ut({color:ve(n.confidence)})},y((n.confidence*100).toFixed(0))+"% ",5)):(r(),k("span",Ut,"—"))]),_:1}),a(G,{prop:"updated_at",label:"Обновлено",width:"180"},{default:t(({row:n})=>[c(y(W(n.updated_at)),1)]),_:1}),a(G,{prop:"last_source_report_id",label:"Источник"},{default:t(({row:n})=>[n.last_source_report_id?(r(),b(oe,{key:0,size:"small"},{default:t(()=>[...e[20]||(e[20]=[c(" Из отчёта ",-1)])]),_:1})):(r(),k("span",Nt,"—"))]),_:1})]),_:1},8,["data"])),[[ie,C.value]]),!q.value.length&&!C.value?(r(),b(se,{key:0,description:"Метрики ещё не извлечены. Загрузите и обработайте отчёты."})):O("",!0)]),_:1}),F.value.length>0?(r(),b(te,{key:1,class:"section-card"},{header:t(()=>[...e[21]||(e[21]=[p("h3",null,"История оценок пригодности",-1)])]),default:t(()=>[a(Ke,null,{default:t(()=>[(r(!0),k(H,null,K(F.value,n=>(r(),b(qe,{key:n.id,timestamp:W(n.created_at),placement:"top"},{default:t(()=>[a(te,null,{default:t(()=>[p("h4",null,y(n.prof_activity_name),1),p("div",Ft,[p("div",Tt,[p("span",It,y(n.score_pct)+"%",1),a(Xe,{percentage:n.score_pct,status:_e(n.score_pct)},null,8,["percentage","status"])]),p("div",Pt,[p("div",zt,[e[22]||(e[22]=p("h5",null,"Сильные стороны:",-1)),n.strengths&&n.strengths.length?(r(),k("ul",Bt,[(r(!0),k(H,null,K(n.strengths,(L,ae)=>(r(),k("li",{key:ae},[p("strong",null,y(L.metric_name),1),c(" — "+y(A(le)(L.value))+" (вес "+y(A(le)(L.weight,2))+") ",1)]))),128))])):(r(),b(se,{key:1,description:"Нет данных","image-size":60}))]),p("div",jt,[e[23]||(e[23]=p("h5",null,"Зоны развития:",-1)),n.dev_areas&&n.dev_areas.length?(r(),k("ul",Jt,[(r(!0),k(H,null,K(n.dev_areas,(L,ae)=>(r(),k("li",{key:ae},[p("strong",null,y(L.metric_name),1),c(" — "+y(A(le)(L.value))+" (вес "+y(A(le)(L.weight,2))+") ",1)]))),128))])):(r(),b(se,{key:1,description:"Нет данных","image-size":60}))]),n.recommendations&&n.recommendations.length?(r(),k("div",Gt,[e[24]||(e[24]=p("h5",null,"Рекомендации:",-1)),p("ul",null,[(r(!0),k(H,null,K(n.recommendations,(L,ae)=>(r(),k("li",{key:ae},y(L),1))),128))])])):O("",!0)]),n.prof_activity_code?(r(),k("div",Ht,[a(v,{type:"info",size:"small",onClick:L=>Je(n)},{default:t(()=>[a(x,null,{default:t(()=>[a(A(ct))]),_:1}),e[25]||(e[25]=c(" Просмотреть JSON ",-1))]),_:1},8,["onClick"]),a(v,{type:"primary",size:"small",onClick:L=>Ge(n)},{default:t(()=>[a(x,null,{default:t(()=>[a(A(Ae))]),_:1}),e[26]||(e[26]=c(" Скачать HTML ",-1))]),_:1},8,["onClick"])])):O("",!0)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})):O("",!0),a(be,{modelValue:J.value,"onUpdate:modelValue":e[5]||(e[5]=n=>J.value=n),title:"Загрузить отчёт",width:"500px"},{footer:t(()=>[a(v,{onClick:e[4]||(e[4]=n=>J.value=!1)},{default:t(()=>[...e[29]||(e[29]=[c(" Отмена ",-1)])]),_:1}),a(v,{type:"primary",loading:U.value,onClick:Fe},{default:t(()=>[...e[30]||(e[30]=[c(" Загрузить ",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(Ee,{ref_key:"uploadFormRef",ref:R,model:u,rules:$,"label-position":"top"},{default:t(()=>[a(we,{label:"Тип отчёта",prop:"report_type"},{default:t(()=>[a(xe,{modelValue:u.report_type,"onUpdate:modelValue":e[3]||(e[3]=n=>u.report_type=n),placeholder:"Выберите тип",style:{width:"100%"}},{default:t(()=>[a(re,{label:"Отчёт 1",value:"REPORT_1"}),a(re,{label:"Отчёт 2",value:"REPORT_2"}),a(re,{label:"Отчёт 3",value:"REPORT_3"})]),_:1},8,["modelValue"])]),_:1}),a(we,{label:"Файл (DOCX)",prop:"file"},{default:t(()=>[a(Qe,{ref:"uploadRef","auto-upload":!1,limit:1,accept:".docx","on-change":Ne,"file-list":i.value},{tip:t(()=>[...e[28]||(e[28]=[p("div",{class:"el-upload__tip"}," Только файлы DOCX, максимум 20 МБ ",-1)])]),default:t(()=>[a(v,{type:"primary"},{default:t(()=>[...e[27]||(e[27]=[c(" Выбрать файл ",-1)])]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(be,{modelValue:d.value,"onUpdate:modelValue":e[8]||(e[8]=n=>d.value=n),title:"Рассчитать профессиональную пригодность",width:"500px"},{footer:t(()=>[a(v,{onClick:e[7]||(e[7]=n=>d.value=!1)},{default:t(()=>[...e[31]||(e[31]=[c(" Отмена ",-1)])]),_:1}),a(v,{type:"primary",loading:M.value,disabled:!N.activityCode||P.value.length===0,onClick:je},{default:t(()=>[...e[32]||(e[32]=[c(" Рассчитать ",-1)])]),_:1},8,["loading","disabled"])]),default:t(()=>[a(Ee,{model:N,"label-position":"top"},{default:t(()=>[a(we,{label:"Профессиональная область",required:""},{default:t(()=>[ue((r(),b(xe,{modelValue:N.activityCode,"onUpdate:modelValue":e[6]||(e[6]=n=>N.activityCode=n),placeholder:"Выберите область",style:{width:"100%"}},{default:t(()=>[(r(!0),k(H,null,K(X.value,n=>(r(),b(re,{key:n.code,label:n.name,value:n.code},{default:t(()=>[p("span",null,y(n.name),1),p("span",Xt,y(n.code),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])),[[ie,D.value]])]),_:1}),a(Ve,{title:"Убедитесь, что у участника загружены и обработаны отчёты с метриками",type:"info",closable:!1,"show-icon":""}),P.value.length===0?(r(),b(Ve,{key:0,title:"У участника нет загруженных отчётов",type:"warning",closable:!1,"show-icon":"",style:{"margin-top":"12px"}})):O("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(be,{modelValue:h.value,"onUpdate:modelValue":e[9]||(e[9]=n=>h.value=n),title:"Метрики отчёта",width:"90%",top:"5vh"},{default:t(()=>[B.value?(r(),b(Et,{key:0,"report-id":B.value,onMetricsUpdated:ze},null,8,["report-id"])):O("",!0)]),_:1},8,["modelValue"])])),[[ie,I.value]])]),_:1})}}},ea=Ce(qt,[["__scopeId","data-v-662df88e"]]);export{ea as default};
