# ===== Core Application =====
# Port for HTTP server (behind NPM with TLS)
APP_PORT=9187

# Trust X-Forwarded-* headers from proxy
UVICORN_PROXY_HEADERS=1
FORWARDED_ALLOW_IPS=*

# Root path for reverse proxy (usually empty)
APP_ROOT_PATH=

# Environment profile: dev|test|ci|prod
ENV=dev

# Deterministic mode for testing (freezes time, seeds)
DETERMINISTIC=0

# ===== Testing & Celery =====
# Run Celery tasks synchronously (auto-enabled in test/ci profiles)
CELERY_TASK_ALWAYS_EAGER=0

# Propagate exceptions in eager mode (auto-enabled in test/ci profiles)
CELERY_EAGER_PROPAGATES_EXCEPTIONS=0

# Allow external network calls (auto-disabled in test/ci profiles)
ALLOW_EXTERNAL_NETWORK=1

# Seed for random number generators in deterministic mode
DETERMINISTIC_SEED=42

# Fixed timestamp for testing (ISO format, auto-set in test/ci profiles)
# Example: 2025-01-15T12:00:00Z
FROZEN_TIME=

# ===== Security =====
# IMPORTANT: Change in production! Generate: openssl rand -hex 32
JWT_SECRET=change_me_to_strong_random_secret_min_32_chars

# JWT algorithm
JWT_ALG=HS256

# Access token lifetime (minutes)
ACCESS_TOKEN_TTL_MIN=30

# ===== Database / Cache / Queue =====
# PostgreSQL async connection string
POSTGRES_DSN=postgresql+asyncpg://app:app@postgres:5432/app

# Redis URL for caching
REDIS_URL=redis://redis:6379/0

# RabbitMQ broker URL for Celery
RABBITMQ_URL=amqp://guest:guest@rabbitmq:5672//

# ===== File Storage =====
# Storage backend: LOCAL|MINIO
FILE_STORAGE=LOCAL

# Base path for LOCAL storage
FILE_STORAGE_BASE=/app/storage

# Maximum allowed .docx upload size (MB)
REPORT_MAX_SIZE_MB=15

# ===== CORS =====
# Allow all CORS origins (disable when behind NPM)
CORS_ALLOW_ALL=false

# Comma-separated allowed origins (if CORS_ALLOW_ALL=false)
# Example: https://prof.labs-edu.ru,https://staging.labs-edu.ru
ALLOWED_ORIGINS=

# ===== Logging =====
# Log level: DEBUG|INFO|WARNING|ERROR
LOG_LEVEL=INFO

# Mask secrets in logs
LOG_MASK_SECRETS=1

# ===== VPN (WireGuard) =====
# Enable VPN for Gemini API access
VPN_ENABLED=0

# VPN type (currently only wireguard)
VPN_TYPE=wireguard

# Path to WireGuard config file
# Example: /app/config/vpn/wireguard/wg0.conf
WG_CONFIG_PATH=

# WireGuard interface name
WG_INTERFACE=wg0

# VPN routing mode: all|domains
VPN_ROUTE_MODE=domains

# Comma-separated domains to route via VPN
VPN_ROUTE_DOMAINS=generativelanguage.googleapis.com

# Comma-separated CIDRs to route via VPN when VPN_ROUTE_MODE=cidr
VPN_ROUTE_CIDRS=

# Comma-separated CIDRs to bypass VPN (local networks)
VPN_BYPASS_CIDRS=172.16.0.0/12,10.0.0.0/8,192.168.0.0/16

# ===== Gemini / AI =====
# Comma-separated Gemini API keys for multi-key rotation
# Get free keys at: https://aistudio.google.com/apikey
# Example: key1,key2,key3
GEMINI_API_KEYS=

# Gemini model for text generation (recommendations)
GEMINI_MODEL_TEXT=gemini-2.5-flash

# Gemini model for vision tasks (OCR fallback)
GEMINI_MODEL_VISION=gemini-2.5-flash

# QPS limit per API key
GEMINI_QPS_PER_KEY=0.5

# Gemini API timeout (seconds)
GEMINI_TIMEOUT_S=30

# Key rotation strategy: ROUND_ROBIN|LEAST_BUSY
GEMINI_STRATEGY=ROUND_ROBIN

# Enable AI-generated recommendations
AI_RECOMMENDATIONS_ENABLED=1

# Enable Gemini Vision fallback for complex table extraction
AI_VISION_FALLBACK_ENABLED=1
